# Бот-администратор для проекта

## Вводные

У образовательного проекта под каждый новый поток создается
20+ чатов в телеграме. Участники в них общаются и учатся

*Мой личный pet-проект. В процессе разработки*


## Библиотеки

— asyncio <br> 
— sqlalchemy<br>
— dotenv<br>
— asyncpg<br>
— pandas<br>
— openpyxl

## Настройка

Создается .env файл в папке config

### Cодержание .env
```python
TOKEN = '' #токен бота с @botFather

#используется PostgreSQL
# PASSWORD - пароль подключения к БД
# NAMEDATABASE - название базы
PostSQL_host = 'postgresql+asyncpg://postgres:PASSWORD@localhost/NAMEDATABASE' 
ROOT = [] # ID владельца
ROOT_CHAT = ROOT
```

## Функции и возможности 
### User handlers — handlers.py

**/start** — приветствует пользователя<br>
**/addme** — регистрирует пользователя и чат в БД. (временная, удалить. Дублирует addchat)<br> 
*Если вызвать в чате с ботом, то зарегистрирует только ID и first_name пользователя в БД*<br>
*Если вызвать в чате с пользователями, то зарегистрирует пользователя и чат в БД*<br>

**/timing** — получает расписание занятий из Excel-файла (доделать)

### Admin handlers — adminpanel.py
Фильтруется через RootProtect(). True - если пользователь имеет id == ROOT в файле .env['ROOT']


**/rpanel** — заглушка для будущей панели администратора<br>
**/chatid** — получить ID конкретного чата, в котором вызван. Отправляет вывод в чат с рут-пользователем<br>
**/addchat** — регистрирует чат в БД вручную. *(добавить вызов функции после получения прав администратора ботом через ChatMemberUpdatedFilter)*<br>
**/dropall** — удаляет данные из БД все<br>
**/send** — отправляет сообщение во все чаты, которые зарегистрированные в БД<br>


**/checkme** — временная функция, которая имитирует вступление пользователя в несколько чатов 


# Описание файлов

### run.py
Основной файл, запускающий работу бота

### config.py
Файл конфигурации. Пока что имеет только функцию get_tokens(name), который выгружает нужные сведения из .env файла

### handlers.py
Хэндлеры для пользователей

### adminpanel.py
Хэндлеры для администратора

### stateuser.py
Состояния пользователя. На данный момент используется только для команды /send

### keyboards.py 
Кнопки для сообщений и бота. На данный момент используется только для команды /send

### models.py
Создание нужных таблиц в БД

### request.py
Запросы к БД

### user_request.py
Пользовательские запросы (временный файл для удобства)

### middlewares.py
Фильтры и миддлвары 

## Структура и функции
### /
Корневая папка. Хранит .gitignore, README.md и run.py <br>
папки app, config, media

### /app 
Хранит все основные файлы .py

### /app/database
Все файлы для работы с БД

### /config
Хранит файл .env и config.py

### /media/Расписание
Папка для хранения расписания проекта в Excel файлах
